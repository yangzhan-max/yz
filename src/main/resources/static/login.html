<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="" content="">
    <title>登陆系统</title>
    <!-- Standard -->
    <link rel="shortcut icon" href="/logo/logo_title.png">
    <!-- Styles -->
    <link href="assets/fontAwesome/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="assets/css/lib/themify-icons.css" rel="stylesheet">
    <link href="assets/css/lib/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/lib/nixon.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="layui/css/layui.css" rel="stylesheet">
</head>
<body class="bg-primary">
<div class="Nixon-login">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-lg-offset-3">
                <div class="login-content">
                    <div class="login-logo">
                        <a><span>By Chen</span></a>
                    </div>
                    <div class="login-form">
                        <h4>教务管理系统登陆</h4>
                        <form>
                            <div id="empty"></div>
                            <div class="form-group">
                                <label>学号</label>
                                <input type="text" id="username" class="form-control" placeholder="输入学号"
                                       oninput="value=value.replace(/[^\d]/g,'')">
                            </div>
                            <div class="form-group">
                                <label>密码</label>
                                <input type="password" id="password" class="form-control" placeholder="输入密码"
                                >
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input id="remember-pwd" type="checkbox"> 记住密码
                                </label>
                                <label class="pull-right">
                                    <a href="reset.html">忘记密码?</a>
                                </label>

                            </div>
                            <button type="button" id="btn-login" class="btn btn-primary btn-flat m-b-30 m-t-30">登陆
                            </button>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="layui/layui.js"></script>
<script>
    layui.use(['layer', 'jquery'], function () {
        let layer = layui.layer, $ = layui.$;
        //登录事件
        $('#btn-login').click(function () {//获取输入框中的账号及密码
                //初始化提示区域
                $('#empty').removeClass().html("");
                let username = $('#username').val();
                let password = $('#password').val();
                if (username.length === 0) {
                    layer.msg('请输入学号');
                    return;
                }
                if (password.length === 0) {
                    layer.msg('请输入密码');
                    return;
                }
                $.ajax({//向后台发起登陆请求
                    url: "/login/login-check",
                    type: "post",
                    data: {
                        username: username,
                        password: password
                    },
                    beforeSend: function () {//防止重复提交
                        $("#btn-login").attr({disabled: "disabled"});
                    },
                    success: function (data) {
                        if (data.code === "201") {//回调状态码:201，账号密码验证成功，链接到商品显示页
                            if ($('#remember-pwd').is(':checked')) { //点击记住密码
                                //将密码放入缓存，key为用户名，value为密码
                                window.localStorage.setItem(username, password);
                            }

                            window.location.href = "index.html";
                            return;
                        }
                        if (data.code === "202" || data.code === "203") {//回调的状态码:202或203,则密码错误或账号不存在
                            $('#empty').addClass("alert alert-danger").html("学号或密码错误，请重新输入！");
                            return;
                        }
                        alert("出现未知错误！");
                    }, complete: function () {
                        $("#btn-login").removeAttr("disabled");
                    },
                    error: function (data) {
                        console.info("error: " + data.responseText);
                    }
                });
            }
        );
        //记住密码
        $('#username').bind('input propertychange', function () {
            //先获取到当前用户名
            let username = $('#username').val();
            //获取cookies里的密码
            let password = window.localStorage.getItem(username);
            //填充密码
            $('#password').val(password);
        })
    });

</script>

</html>
